<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#ffd700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="A&A Perfumer√≠a">
    <title>A&A Perfumer√≠a - M√≥vil Ultra</title>
    
    <!-- CSS para datos del cliente -->
    <link rel="stylesheet" href="css/shared/customer-data.css">
    <link rel="stylesheet" href="css/shared/search-aa-mobile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* CSS Cr√≠tico Optimizado */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #ffd700;
            --primary-light: #ffed4e;
            --secondary: #1e1e1e;
            --secondary-light: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --bg-glass: rgba(255,255,255,0.05);
            --border-glass: 1px solid rgba(255,255,255,0.1);
            --border-primary: 1px solid rgba(255,215,0,0.3);
            --radius-sm: 15px;
            --radius-md: 20px;
            --spacing-sm: 1rem;
            --transition: 0.3s ease;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            border: 3px solid lime; /* Indicador de funcionamiento */
        }
        
        /* Header */
        .header {
            position: sticky;
            top: 0;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: var(--border-primary);
            padding: var(--spacing-sm);
            text-align: center;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            margin-top: 0.5rem;
        }
        
        .nav-back {
            background: var(--bg-glass);
            border: var(--border-glass);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .cart-button {
            position: relative;
            background: var(--bg-glass);
            border: var(--border-primary);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .cart-icon {
            width: 24px;
            height: 24px;
            filter: brightness(0) invert(1);
        }
        
        .cart-counter {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #ff4757, #ff6b7a);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            border: 2px solid rgba(255,255,255,0.3);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }
        
        .cart-counter.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        /* Container y resto de estilos */
        .container { padding: 0 var(--spacing-sm); max-width: 100%; }
        .filters { padding: var(--spacing-sm) 0; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .filters-scroll { display: flex; gap: 0.5rem; padding: 0 var(--spacing-sm); min-width: max-content; }
        .filter-btn { background: var(--bg-glass); border: var(--border-glass); color: var(--text-secondary); padding: 12px 20px; border-radius: 25px; font-size: 0.9rem; cursor: pointer; transition: var(--transition); white-space: nowrap; min-height: 44px; }
        .filter-btn.active { background: linear-gradient(45deg, var(--primary), var(--primary-light)); color: var(--secondary); border-color: var(--primary); }
        .filter-btn:active { transform: scale(0.95); }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; padding: 1rem 0; }
        .product-card { background: var(--bg-glass); border: var(--border-glass); border-radius: var(--radius-md); padding: var(--spacing-sm); transition: all var(--transition); cursor: pointer; }
        .product-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .product-image { width: 100%; height: 200px; border-radius: var(--radius-sm); overflow: hidden; margin-bottom: var(--spacing-sm); position: relative; background: var(--bg-glass); display: flex; align-items: center; justify-content: center; font-size: 3rem; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; }
        .product-info { text-align: left; }
        .product-name { font-size: 1.1rem; font-weight: bold; margin-bottom: 0.5rem; color: var(--primary); }
        .product-description { font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem; line-height: 1.4; }
        .product-price { font-size: 1rem; font-weight: bold; color: var(--text-primary); margin-bottom: 1rem; }
        .btn-product-action { background: linear-gradient(45deg, var(--primary), var(--primary-light)); color: var(--secondary); border: none; padding: 12px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; width: 100%; transition: all var(--transition); }
        .btn-product-action:active { transform: scale(0.95); }
        .loading { text-align: center; padding: 2rem; color: var(--primary); }
        .d-none { display: none !important; }
        .text-center { text-align: center; }
        
        /* Estilos para modales */
        .product-modal, .cart-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .product-modal.active, .cart-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content, .cart-modal-content {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
            border: 2px solid var(--primary);
            border-radius: var(--radius-md);
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .product-modal.active .modal-content,
        .cart-modal.active .cart-modal-content {
            transform: scale(1);
        }
        
        .modal-close, .cart-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 2rem;
            cursor: pointer;
            z-index: 10001;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover, .cart-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        
        @media (max-width: 768px) { 
            .products-grid { grid-template-columns: 1fr; gap: 1rem; } 
            .header h1 { font-size: 1.5rem; }
            .modal-content, .cart-modal-content {
                padding: 1.5rem;
                max-width: 95%;
                max-height: 95%;
            }
        }
        @supports (padding: max(0px)) { .header { padding-left: max(var(--spacing-sm), env(safe-area-inset-left)); padding-right: max(var(--spacing-sm), env(safe-area-inset-right)); padding-top: max(var(--spacing-sm), env(safe-area-inset-top)); } }

        /* Estilos para cartelones de novedades m√≥vil */
        .novedades-container-mobile {
            margin: 1rem 0;
            opacity: 1;
            transition: all 0.5s ease;
        }
        
        .novedades-container-mobile.hidden {
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
        }
        
        .novedades-grid-mobile {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            padding: 0 var(--spacing-sm);
        }
        
        .cartelon-item-mobile {
            background: var(--bg-glass);
            border: 2px solid var(--primary);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            height: 200px;
        }
        
        .cartelon-item-mobile:hover {
            transform: translateY(-5px);
            border-color: var(--primary-light);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }
        
        .cartelon-image-mobile {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .cartelon-item-mobile:hover .cartelon-image-mobile {
            transform: scale(1.05);
        }
        
        .cartelon-overlay-mobile {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 1.5rem;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }
        
        .cartelon-title-mobile {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .cartelon-description-mobile {
            font-size: 0.9rem;
            color: #ccc;
            line-height: 1.4;
        }
        
        /* Animaci√≥n de pulso para bot√≥n novedades */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 122, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 122, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 122, 0); }
        }
        
        /* Estilos especiales para cartel√≥n de ubicaci√≥n m√≥vil */
        .cartelon-ubicacion-mobile {
            border-color: rgba(255, 215, 0, 0.4);
            background: rgba(255, 215, 0, 0.05);
        }
        
        .cartelon-ubicacion-mobile:hover {
            border-color: rgba(255, 215, 0, 0.8);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
            transform: translateY(-8px);
        }
        
        .cartelon-ubicacion-info-mobile {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .ubicacion-direcciones-mobile {
            margin-bottom: 10px;
        }
        
        .direccion-item-mobile {
            background: rgba(0, 0, 0, 0.3);
            padding: 6px 10px;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 0.7rem;
            line-height: 1.3;
        }
        
        .direccion-item-mobile strong {
            color: var(--primary);
        }
        
        .ubicacion-botones-mobile {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .btn-ubicacion-mobile {
            flex: 1;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            color: var(--secondary);
            border: none;
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .btn-ubicacion-mobile:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        
        .btn-ubicacion-mobile.whatsapp {
            background: linear-gradient(45deg, #25D366, #20b358);
            color: white;
        }
        
        .btn-ubicacion-mobile.whatsapp:hover {
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
        }

        /* Responsive para cartelones */
        @media (max-width: 480px) {
            .cartelon-item-mobile {
                height: 180px;
            }
            
            .cartelon-overlay-mobile {
                padding: 1rem;
            }
            
            .cartelon-title-mobile {
                font-size: 1rem;
            }
            
            .cartelon-description-mobile {
                font-size: 0.8rem;
            }
            
            .direccion-item-mobile {
                font-size: 0.65rem;
                padding: 5px 8px;
            }
            
            .btn-ubicacion-mobile {
                font-size: 0.65rem;
                padding: 5px 8px;
                min-width: 70px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>A&A Perfumer√≠a</h1>
        <p>Fragancias inspiradas, creadas con amor</p>
        
        <nav class="nav-container">
            <a href="index.html" class="nav-back">‚Üê Inicio</a>
            <button class="cart-button" onclick="openCartModal()">
                <img class="cart-icon" id="cartIcon" src="recursos/A&A/Material Grafico/Carrito_de_compras_Vacio.png" alt="Carrito">
                <div class="cart-counter" id="cartCounter">0</div>
            </button>
        </nav>
    </header>

    <!-- Secci√≥n de B√∫squeda -->
    <div class="search-section-mobile">
        <div class="search-container-mobile">
            <div class="search-bar-mobile">
                <input type="text" 
                       id="search-input" 
                       class="search-input-mobile" 
                       placeholder="Busca tu perfume (ej: Alam, Chanel)...">
                <button id="search-button" class="search-button-mobile">
                    <i class="fas fa-search"></i>
                    Buscar
                </button>
            </div>
        </div>
    </div>

    <!-- Resultados de b√∫squeda -->
    <div id="search-results" style="display: none;">
        <!-- Los resultados se mostrar√°n aqu√≠ -->
    </div>

    <!-- Main Content -->
    <main class="container">
        <!-- Filtros -->
        <section class="filters">
            <!-- Bot√≥n de Novedades -->
            <div style="text-align: center; margin-bottom: 1rem;">
                <button class="filter-btn novedades-btn" id="novedadesBtn" onclick="MobileApp.showNovedades()" 
                        style="background: linear-gradient(45deg, #ff6b7a, #ff4757); color: white; 
                               border: none; padding: 12px 24px; border-radius: 25px; font-weight: bold; 
                               cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 107, 122, 0.3);
                               animation: pulse 2s infinite;">
                    üéâ Novedades
                </button>
            </div>
            
            <div class="filters-scroll" id="filtersContainer">
                <!-- Los filtros se cargar√°n aqu√≠ -->
            </div>
        </section>

        <!-- Cartelones de Novedades -->
        <section class="novedades-container-mobile" id="novedadesContainer" style="display: block;">
            <div class="novedades-grid-mobile" id="novedadesGrid">
                <!-- Los cartelones se cargar√°n aqu√≠ con JavaScript -->
            </div>
        </section>

        <!-- Loading -->
        <div id="loading" class="loading d-none">Cargando productos...</div>

        <!-- Grid de Productos -->
        <section id="productsGrid" class="products-grid">
            <!-- Los productos se cargar√°n aqu√≠ -->
        </section>

        <!-- Mensaje de No Productos -->
        <div id="noProductsMessage" class="d-none text-center">
            <p style="opacity: 0.7;">No se encontraron productos en esta categor√≠a.</p>
        </div>
    </main>

    <!-- Scripts - Reutilizando sistemas existentes que funcionaban -->
    <script src="js/shared/config.js"></script>
    <script src="js/shared/search-aa.js"></script>
    <script src="js/shared/cart-simple.js"></script>
    <script src="js/shared/customer-data.js"></script>
    <script src="js/shared/simple-music.js"></script>
    
    <script>
        console.log('üöÄ Iniciando A&A Mobile Ultra con JS reutilizados...');
        
        // Variables globales
        let currentProduct = null;
        let selectedSize = '30ml';
        let selectedExtras = [];
        
        // Clase simplificada que reutiliza sistemas existentes
        class MobileAAApp {
            constructor() {
                this.currentCategory = 'todos';
                this.isLoading = false;
                console.log('üì± MobileAAApp constructor ejecutado');
                this.init();
            }
            
            init() {
                console.log('üîß Inicializando MobileAAApp...');
                
                try {
                    this.loadFilters();
                    this.loadProducts('todos');
                    
                    // Cambiar borde a dorado para indicar √©xito
                    document.body.style.borderColor = 'gold';
                    console.log('‚úÖ MobileAAApp inicializado correctamente');
                    
                } catch (error) {
                    console.error('‚ùå Error en init:', error);
                    document.body.style.borderColor = 'red';
                }
            }
            
            loadFilters() {
                const container = document.getElementById('filtersContainer');
                if (!container) return;
                
                const filters = [
                    { key: 'todos', label: 'Todos' },
                    { key: 'caballero', label: 'Caballero' },
                    { key: 'dama', label: 'Dama' },
                    { key: 'unisex', label: 'Unisex' }
                ];
                
                const html = filters.map(filter => `
                    <button class="filter-btn ${filter.key === 'todos' ? 'active' : ''}" 
                            onclick="MobileApp.loadProducts('${filter.key}')">
                        ${filter.label}
                    </button>
                `).join('');
                
                container.innerHTML = html;
                console.log('üè∑Ô∏è Filtros cargados');
                
                // Cargar cartelones de novedades
                this.loadNovedades();
            }
            
            loadNovedades() {
                console.log('üéâ Cargando cartelones de novedades');
                
                // Datos de los cartelones (igual que en PC)
                const cartelones = [
                    {
                        imagen: 'recursos/A&A/Material Grafico/CartelonDamayCabellero.jpg',
                        titulo: 'Fragancias para Dama y Caballero',
                        descripcion: 'Descubre nuestra exclusiva colecci√≥n de perfumes inspirados en las fragancias m√°s populares del mundo.'
                    },
                    {
                        imagen: 'recursos/A&A/Material Grafico/CartelonDePerdumesInspirados.jpg',
                        titulo: 'Perfumes Inspirados',
                        descripcion: 'Calidad premium a precios accesibles. Cada fragancia es cuidadosamente elaborada para ofrecerte la mejor experiencia.'
                    },
                    {
                        imagen: 'recursos/A&A/Material Grafico/CartelonMarcoPerfume.jpg',
                        titulo: 'Marco de Perfume',
                        descripcion: 'Presentaci√≥n elegante y sofisticada para cada uno de nuestros productos exclusivos.'
                    },
                    {
                        imagen: 'recursos/A&A/Material Grafico/ParonamaDeLogoConRedesSociales.jpg',
                        titulo: 'S√≠guenos en Redes Sociales',
                        descripcion: 'Mantente al d√≠a con nuestras √∫ltimas novedades, promociones y lanzamientos exclusivos.'
                    },
                    {
                        imagen: 'recursos/A&A/Material Grafico/VistaProductoConContactos.jpg',
                        titulo: 'Contacto y Atenci√≥n',
                        descripcion: 'Estamos aqu√≠ para ayudarte. Cont√°ctanos por WhatsApp para asesor√≠a personalizada.'
                    },
                    {
                        imagen: 'recursos/A&A/Material Grafico/CartelonDeUbicacionVariante1.jpg',
                        titulo: 'üìç Ub√≠canos',
                        descripcion: 'Visita nuestras sucursales en Orizaba, Veracruz. Te esperamos con los brazos abiertos.',
                        tipo: 'ubicacion',
                        enlace: 'ubicaciones.html'
                    }
                ];
                
                const novedadesGrid = document.getElementById('novedadesGrid');
                if (!novedadesGrid) return;
                
                const html = cartelones.map(cartelon => `
                    <div class="cartelon-item-mobile ${cartelon.tipo === 'ubicacion' ? 'cartelon-ubicacion-mobile' : ''}" 
                         ${cartelon.enlace ? `onclick="window.open('${cartelon.enlace}', '_blank')" style="cursor: pointer;"` : ''}>
                        <img src="${cartelon.imagen}" alt="${cartelon.titulo}" class="cartelon-image-mobile" 
                             onload="this.style.opacity='1'" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.background='linear-gradient(45deg, #333, #555)'; this.nextElementSibling.style.display='flex'; this.nextElementSibling.style.alignItems='center'; this.nextElementSibling.style.justifyContent='center'; this.nextElementSibling.innerHTML='<div style=color:#888;font-size:2rem>A&A</div>'"
                             style="opacity: 0; transition: opacity 0.5s ease;">
                        <div class="cartelon-overlay-mobile">
                            <div class="cartelon-title-mobile">${cartelon.titulo}</div>
                            <div class="cartelon-description-mobile">${cartelon.descripcion}</div>
                            ${cartelon.tipo === 'ubicacion' ? `
                                <div class="cartelon-ubicacion-info-mobile">
                                    <div class="ubicacion-direcciones-mobile">
                                        <div class="direccion-item-mobile">
                                            <strong>üìç Sucursal Principal:</strong><br>
                                            Prol. de Nte. 8, UNE, 94310 Orizaba, Ver.
                                        </div>
                                        <div class="direccion-item-mobile">
                                            <strong>üìç Sucursal 2:</strong><br>
                                            Oriente 3, Nte. 10, 94300 Orizaba, Ver.
                                        </div>
                                    </div>
                                    <div class="ubicacion-botones-mobile">
                                        <button class="btn-ubicacion-mobile" onclick="event.stopPropagation(); window.open('ubicaciones.html', '_blank')">
                                            üó∫Ô∏è Ver Mapa
                                        </button>
                                        <button class="btn-ubicacion-mobile whatsapp" onclick="event.stopPropagation(); window.open('https://wa.me/2721224946', '_blank')">
                                            üí¨ WhatsApp
                                        </button>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
                
                novedadesGrid.innerHTML = html;
                console.log('‚úÖ Cartelones de novedades cargados');
            }
            
            showNovedades() {
                console.log('üéâ Mostrando cartelones de novedades');
                
                const novedadesContainer = document.getElementById('novedadesContainer');
                const productsGrid = document.getElementById('productsGrid');
                const novedadesBtn = document.getElementById('novedadesBtn');
                const searchResults = document.getElementById('search-results');
                const container = document.querySelector('.container');
                const noProductsMessage = document.getElementById('noProductsMessage');
                
                // Asegurar que el contenedor principal est√© visible
                if (container) container.style.display = 'block';
                
                // Mostrar cartelones y ocultar otros elementos
                if (novedadesContainer) {
                    novedadesContainer.style.display = 'block';
                    novedadesContainer.classList.remove('hidden');
                }
                if (productsGrid) productsGrid.style.display = 'none';
                if (novedadesBtn) novedadesBtn.style.display = 'none';
                if (searchResults) {
                    searchResults.innerHTML = '';
                    searchResults.style.display = 'none';
                }
                if (noProductsMessage) noProductsMessage.classList.add('d-none');
                
                // Resetear botones activos
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                
                // Limpiar b√∫squeda si hay texto
                const searchInput = document.getElementById('search-input');
                if (searchInput && searchInput.value.trim() !== '') {
                    searchInput.value = '';
                }
                
                console.log('‚úÖ Cartelones de novedades mostrados - Estado inicial restaurado');
            }
            
            loadProducts(category) {
                if (this.isLoading) return;
                
                console.log('üì¶ Cargando productos para:', category);
                this.isLoading = true;
                this.currentCategory = category;
                
                // Ocultar cartelones y mostrar productos
                const novedadesContainer = document.getElementById('novedadesContainer');
                const productsGrid = document.getElementById('productsGrid');
                const novedadesBtn = document.getElementById('novedadesBtn');
                const searchResults = document.getElementById('search-results');
                
                if (novedadesContainer) novedadesContainer.style.display = 'none';
                if (productsGrid) productsGrid.style.display = 'grid';
                if (novedadesBtn) novedadesBtn.style.display = 'block';
                if (searchResults) searchResults.style.display = 'none';
                
                // Actualizar filtros activos
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[onclick="MobileApp.loadProducts('${category}')"]`)?.classList.add('active');
                
                setTimeout(() => {
                    try {
                        // Verificar si PRODUCTOS existe y es un array
                        if (typeof PRODUCTOS === 'undefined' || !Array.isArray(PRODUCTOS)) {
                            console.error('‚ùå PRODUCTOS no est√° definido o no es un array v√°lido');
                            this.showError('Error: No se pudieron cargar los productos. Verifica que config.js est√© cargado correctamente.');
                            return;
                        }
                        
                        // Verificar si CONFIG existe
                        if (typeof CONFIG === 'undefined') {
                            console.warn('‚ö†Ô∏è CONFIG no est√° definido, usando valores por defecto');
                        }
                        
                        // Usar PRODUCTOS de config.js con mapeo de categor√≠as
                        let products;
                        if (category === 'todos') {
                            products = PRODUCTOS;
                        } else {
                            // Mapear categor√≠as para compatibilidad
                            const categoryMap = {
                                'caballero': ['hombre', 'caballero'],
                                'dama': ['mujer', 'dama'],
                                'unisex': ['unisex']
                            };
                            
                            const validCategories = categoryMap[category] || [category];
                            products = PRODUCTOS.filter(p => validCategories.includes(p.categoria));
                        }
                        this.renderProducts(products);
                        console.log(`‚úÖ ${products.length} productos cargados`);
                    } catch (error) {
                        console.error('‚ùå Error cargando productos:', error);
                        this.showError('Error cargando productos: ' + error.message);
                    } finally {
                        this.isLoading = false;
                    }
                }, 300);
            }
            
            renderProducts(products) {
                const grid = document.getElementById('productsGrid');
                const noProductsMsg = document.getElementById('noProductsMessage');
                
                if (!grid) return;
                
                if (products.length === 0) {
                    grid.innerHTML = '';
                    noProductsMsg?.classList.remove('d-none');
                    return;
                }
                
                noProductsMsg?.classList.add('d-none');
                
                const html = products.map(product => `
                    <div class="product-card" onclick="MobileApp.openProductModal(${product.id})">
                        <div class="product-image">
                            <img src="${product.imagen}" alt="${product.nombre}" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                            <div class="product-placeholder" style="display: none;">
                                ${this.getProductEmoji(product.categoria)}
                            </div>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.nombre}</h3>
                            <p class="product-description">${product.descripcion}</p>
                            <div class="product-price">${product.precio}</div>
                            <button class="btn-product-action" 
                                    onclick="event.stopPropagation(); MobileApp.openProductModal(${product.id})">
                                Ver detalles
                            </button>
                        </div>
                    </div>
                `).join('');
                
                grid.innerHTML = html;
                console.log('üé® Productos renderizados');
            }
            
            getProductEmoji(categoria) {
                const emojis = { 
                    'caballero': 'üë®', 
                    'dama': 'üë©', 
                    'hombre': 'üë®',
                    'mujer': 'üë©',
                    'unisex': 'üí´' 
                };
                return emojis[categoria] || 'üåü';
            }
            
            showError(mensaje) {
                console.error('üö® Error:', mensaje);
                
                // Mostrar error en la interfaz
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(255, 0, 0, 0.9);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 10px;
                    z-index: 10000;
                    max-width: 90%;
                    text-align: center;
                    font-weight: bold;
                    box-shadow: 0 4px 20px rgba(255, 0, 0, 0.3);
                `;
                errorDiv.textContent = mensaje;
                
                document.body.appendChild(errorDiv);
                
                // Remover despu√©s de 5 segundos
                setTimeout(() => {
                    if (errorDiv.parentElement) {
                        errorDiv.remove();
                    }
                }, 5000);
            }
            
            openProductModal(productId) {
                console.log('üîç Intentando abrir modal para producto ID:', productId);
                
                // Verificar si PRODUCTOS existe
                if (typeof PRODUCTOS === 'undefined' || !Array.isArray(PRODUCTOS)) {
                    console.error('‚ùå PRODUCTOS no est√° disponible');
                    this.showError('Error: No se pueden cargar los datos del producto');
                    return;
                }
                
                const product = PRODUCTOS.find(p => p.id === productId);
                if (!product) {
                    console.error('‚ùå Producto no encontrado:', productId);
                    this.showError('Producto no encontrado');
                    return;
                }
                
                currentProduct = product;
                console.log('üîç Abriendo modal para:', product.nombre);
                
                // Intentar usar el sistema existente de cart-simple.js
                try {
                    if (typeof window.openProductModal === 'function') {
                        console.log('‚úÖ Usando openProductModal de cart-simple.js');
                        window.openProductModal(product.nombre);
                    } else {
                        console.log('‚ö†Ô∏è openProductModal no disponible, usando fallback');
                        this.createSimpleProductModal(product);
                    }
                } catch (error) {
                    console.error('‚ùå Error abriendo modal:', error);
                    console.log('üîÑ Usando modal simple como fallback');
                    this.createSimpleProductModal(product);
                }
            }
            
            createSimpleProductModal(product) {
                console.log('üîß Creando modal simple para:', product.nombre);
                
                // Remover modal existente si hay uno
                const existingModal = document.querySelector('.simple-product-modal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // Crear modal simple
                const modal = document.createElement('div');
                modal.className = 'product-modal simple-product-modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="window.closeModal('.simple-product-modal')">&times;</button>
                        
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <img src="${product.imagen}" alt="${product.nombre}" 
                                 style="width: 120px; height: 120px; object-fit: cover; border-radius: 15px; margin-bottom: 1rem;"
                                 onerror="this.style.display='none'">
                            <h2 style="color: var(--primary); margin-bottom: 0.5rem;">${product.nombre}</h2>
                            <p style="color: var(--text-secondary); font-style: italic; margin-bottom: 0.5rem;">${product.inspirado || 'Fragancia exclusiva'}</p>
                            <p style="color: var(--text-primary); margin-bottom: 1rem;">${product.descripcion}</p>
                            <div style="background: rgba(0, 255, 0, 0.1); color: #00ff88; padding: 0.5rem; border-radius: 10px; margin-bottom: 1rem;">
                                <span style="display: inline-block; width: 8px; height: 8px; background: #00ff88; border-radius: 50%; margin-right: 0.5rem;"></span>
                                Disponible - Entrega inmediata
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="margin-bottom: 1.5rem;">
                                <h3 style="color: var(--primary); margin-bottom: 1rem;">Precio: ${product.precio}</h3>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                                    Tama√±os disponibles: 10ml ($90), 30ml ($160), 60ml ($220), 100ml ($285)
                                </p>
                                <div id="addressInfo" style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 0.8rem; font-size: 0.85rem;">
                                    <div style="color: var(--primary); font-weight: bold; margin-bottom: 0.3rem;">üìç Informaci√≥n de Entrega:</div>
                                    <div style="color: var(--text-secondary);" id="savedAddressDisplay">
                                        Se solicitar√°n tus datos de entrega al procesar el pedido
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                <button onclick="window.requestProductOrder(currentProduct)" 
                                        style="background: linear-gradient(45deg, var(--primary), var(--primary-light)); 
                                               color: var(--secondary); border: none; padding: 12px 24px; 
                                               border-radius: 25px; font-weight: bold; cursor: pointer; 
                                               transition: all 0.3s ease;">
                                    Pedir por WhatsApp
                                </button>
                                <button onclick="window.clearCustomerData()" 
                                        style="background: rgba(255, 165, 0, 0.2); color: #ffa500; 
                                               border: 1px solid rgba(255, 165, 0, 0.3); padding: 12px 24px; 
                                               border-radius: 25px; font-weight: bold; cursor: pointer; 
                                               transition: all 0.3s ease;">
                                    Cambiar Direcci√≥n
                                </button>
                                <button onclick="window.closeModal('.simple-product-modal')" 
                                        style="background: rgba(255,255,255,0.05); color: white; 
                                               border: 1px solid rgba(255,255,255,0.1); padding: 12px 24px; 
                                               border-radius: 25px; font-weight: bold; cursor: pointer; 
                                               transition: all 0.3s ease;">
                                    Cerrar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                document.body.style.overflow = 'hidden';
                
                // Mostrar informaci√≥n de direcci√≥n guardada si existe
                setTimeout(() => {
                    this.updateAddressDisplay();
                }, 50);
                
                // Mostrar con animaci√≥n
                setTimeout(() => {
                    modal.classList.add('active');
                }, 10);
                
                console.log('‚úÖ Modal simple creado y mostrado');
            }
            
            requestProductOrder(product) {
                console.log('üìû Solicitando pedido para:', product.nombre);
                
                // Cerrar modal si est√° abierto
                const modal = document.querySelector('.simple-product-modal');
                if (modal) {
                    modal.remove();
                    document.body.style.overflow = 'auto';
                }
                
                // Verificar si customerDataManager existe
                if (typeof customerDataManager === 'undefined') {
                    console.warn('‚ö†Ô∏è customerDataManager no est√° disponible, usando m√©todo directo');
                    this.directWhatsAppOrder(product);
                    return;
                }
                
                // Mostrar selector de direcciones m√∫ltiples
                this.showAddressSelector(product);
            }
            
            directWhatsAppOrder(product) {
                console.log('üì± Enviando pedido directo a WhatsApp');
                
                let mensaje = `üõí *Consulta de Producto*\n\n`;
                mensaje += `üì¶ Producto: ${product.nombre}\n`;
                mensaje += `‚ú® Inspirado en: ${product.inspirado || 'Fragancia exclusiva'}\n`;
                mensaje += `üìù Descripci√≥n: ${product.descripcion}\n`;
                mensaje += `üí∞ Precio: ${product.precio}\n\n`;
                mensaje += `Hola! Me interesa este perfume. ¬øPodr√≠as darme m√°s informaci√≥n sobre tama√±os disponibles, precios y opciones de entrega?\n\n`;
                mensaje += `¬°Gracias!`;
                
                const whatsappNumber = (CONFIG && CONFIG.whatsapp && CONFIG.whatsapp.numero) || '2721224946';
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(mensaje)}`;
                window.open(whatsappUrl, '_blank');
                
                console.log('‚úÖ Consulta directa enviada a WhatsApp');
            }
            
            updateAddressDisplay() {
                const addressDisplay = document.getElementById('savedAddressDisplay');
                if (!addressDisplay) return;
                
                // Mostrar informaci√≥n de direcciones m√∫ltiples
                const addresses = this.getSavedAddresses();
                if (addresses.length > 0) {
                    addressDisplay.innerHTML = `
                        <div style="color: #00ff88; margin-bottom: 0.3rem;">‚úÖ ${addresses.length} direcci√≥n${addresses.length > 1 ? 'es' : ''} guardada${addresses.length > 1 ? 's' : ''}:</div>
                        <div style="color: var(--text-primary); font-size: 0.9rem;">
                            ${addresses.map((addr, i) => `üìç ${i + 1}. ${addr.nombreCompleto} - ${addr.municipio}, ${addr.estado}`).join('<br>')}
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.3rem;">
                            Podr√°s seleccionar cu√°l usar al hacer el pedido
                        </div>
                    `;
                } else {
                    addressDisplay.innerHTML = `
                        <div style="color: var(--text-secondary);">
                            Se solicitar√°n tus datos de entrega al procesar el pedido
                        </div>
                    `;
                }
            }
            
            // ===== SISTEMA DE M√öLTIPLES DIRECCIONES =====
            
            getSavedAddresses() {
                try {
                    const addresses = localStorage.getItem('aa_customer_addresses');
                    return addresses ? JSON.parse(addresses) : [];
                } catch (error) {
                    console.error('Error cargando direcciones:', error);
                    return [];
                }
            }
            
            showAddressSelector(product) {
                console.log('üè† Mostrando selector de direcciones para:', product.nombre);
                
                // Obtener direcciones guardadas
                const savedAddresses = this.getSavedAddresses();
                
                // Crear modal de selecci√≥n de direcciones
                const modal = document.createElement('div');
                modal.className = 'product-modal address-selector-modal';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 500px;">
                        <button class="modal-close" onclick="window.closeModal('.address-selector-modal')">&times;</button>
                        
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <h2 style="color: var(--primary); margin-bottom: 1rem;">üìç Seleccionar Direcci√≥n de Entrega</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                Para: <strong style="color: var(--primary);">${product.nombre}</strong>
                            </p>
                        </div>
                        
                        <div id="addressesList" style="margin-bottom: 2rem;">
                            ${this.renderAddressesList(savedAddresses)}
                        </div>
                        
                        <div style="text-align: center;">
                            <button onclick="MobileApp.addNewAddress('${product.id}')" 
                                    style="background: linear-gradient(45deg, #00ff88, #00cc6a); 
                                           color: #000; border: none; padding: 12px 24px; 
                                           border-radius: 25px; font-weight: bold; cursor: pointer; 
                                           transition: all 0.3s ease; margin: 5px;">
                                ‚ûï Agregar Nueva Direcci√≥n
                            </button>
                            <button onclick="window.closeModal('.address-selector-modal')" 
                                    style="background: rgba(255,255,255,0.05); color: white; 
                                           border: 1px solid rgba(255,255,255,0.1); padding: 12px 24px; 
                                           border-radius: 25px; font-weight: bold; cursor: pointer; 
                                           transition: all 0.3s ease; margin: 5px;">
                                Cancelar
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                document.body.style.overflow = 'hidden';
                
                // Mostrar con animaci√≥n
                setTimeout(() => {
                    modal.classList.add('active');
                }, 10);
                
                console.log('‚úÖ Selector de direcciones mostrado');
            }
            
            renderAddressesList(addresses) {
                if (addresses.length === 0) {
                    return `
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
                            <h3 style="color: var(--primary); margin-bottom: 0.5rem;">No hay direcciones guardadas</h3>
                            <p>Agrega tu primera direcci√≥n para empezar</p>
                        </div>
                    `;
                }
                
                return addresses.map((address, index) => `
                    <div class="address-card" style="background: rgba(255,255,255,0.05); 
                         border: 2px solid rgba(255,255,255,0.1); border-radius: 15px; 
                         padding: 1.5rem; margin-bottom: 1rem; cursor: pointer; 
                         transition: all 0.3s ease;"
                         onclick="MobileApp.selectAddress(${index})"
                         onmouseover="this.style.borderColor='var(--primary)'"
                         onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <h4 style="color: var(--primary); margin: 0;">
                                üìç Direcci√≥n ${index + 1}
                            </h4>
                            <div>
                                <button onclick="event.stopPropagation(); MobileApp.editAddress(${index})" 
                                        style="background: rgba(255, 165, 0, 0.2); color: #ffa500; 
                                               border: 1px solid rgba(255, 165, 0, 0.3); padding: 5px 10px; 
                                               border-radius: 15px; font-size: 0.8rem; cursor: pointer; margin-right: 5px;">
                                    ‚úèÔ∏è Editar
                                </button>
                                <button onclick="event.stopPropagation(); MobileApp.deleteAddressConfirm(${index})" 
                                        style="background: rgba(255, 0, 0, 0.2); color: #ff4757; 
                                               border: 1px solid rgba(255, 0, 0, 0.3); padding: 5px 10px; 
                                               border-radius: 15px; font-size: 0.8rem; cursor: pointer;">
                                    üóëÔ∏è Eliminar
                                </button>
                            </div>
                        </div>
                        
                        <div style="color: var(--text-primary); line-height: 1.5;">
                            <div><strong>üë§ ${address.nombreCompleto}</strong></div>
                            <div>üì± ${address.telefono}</div>
                            <div>üè† ${address.calleAvenida} #${address.numeroCasa}</div>
                            <div>üèôÔ∏è ${address.municipio}, ${address.estado}</div>
                            <div>üìÆ CP: ${address.codigoPostal}</div>
                            ${address.referencia ? `<div>üìç ${address.referencia}</div>` : ''}
                        </div>
                        
                        <div style="margin-top: 1rem; text-align: center;">
                            <button onclick="event.stopPropagation(); MobileApp.useThisAddress(${index})" 
                                    style="background: linear-gradient(45deg, var(--primary), var(--primary-light)); 
                                           color: var(--secondary); border: none; padding: 10px 20px; 
                                           border-radius: 20px; font-weight: bold; cursor: pointer; 
                                           transition: all 0.3s ease;">
                                ‚úÖ Usar Esta Direcci√≥n
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            showAddressForm(productId, existingData = null, editIndex = null) {
                console.log('üìù Mostrando formulario de direcci√≥n');
                
                const isEditing = existingData !== null;
                const title = isEditing ? 'Editar Direcci√≥n' : 'Nueva Direcci√≥n de Entrega';
                
                const modal = document.createElement('div');
                modal.className = 'product-modal address-form-modal';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                        <button class="modal-close" onclick="window.closeModal('.address-form-modal')">&times;</button>
                        
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <h2 style="color: var(--primary); margin-bottom: 1rem;">üìù ${title}</h2>
                            <p style="color: var(--text-secondary);">
                                ${isEditing ? 'Modifica los datos que necesites' : 'Completa tus datos de entrega'}
                            </p>
                        </div>
                        
                        <form id="addressForm" style="text-align: left;">
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: var(--primary); margin-bottom: 1rem;">üë§ Informaci√≥n Personal</h4>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                        Nombre Completo *
                                    </label>
                                    <input type="text" id="nombreCompleto" name="nombreCompleto" 
                                           value="${existingData?.nombreCompleto || ''}"
                                           placeholder="Ej: Juan P√©rez Garc√≠a" required
                                           style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                  border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                  color: var(--text-primary); font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                        Tel√©fono *
                                    </label>
                                    <input type="tel" id="telefono" name="telefono" 
                                           value="${existingData?.telefono || ''}"
                                           placeholder="Ej: 2721234567" required maxlength="10"
                                           style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                  border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                  color: var(--text-primary); font-size: 1rem;">
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <h4 style="color: var(--primary); margin-bottom: 1rem;">üìç Direcci√≥n de Entrega</h4>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                            Estado *
                                        </label>
                                        <input type="text" id="estado" name="estado" 
                                               value="${existingData?.estado || ''}"
                                               placeholder="Ej: Veracruz" required
                                               style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                      border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                      color: var(--text-primary); font-size: 1rem;">
                                    </div>
                                    <div>
                                        <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                            Municipio/Ciudad *
                                        </label>
                                        <input type="text" id="municipio" name="municipio" 
                                               value="${existingData?.municipio || ''}"
                                               placeholder="Ej: Xalapa" required
                                               style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                      border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                      color: var(--text-primary); font-size: 1rem;">
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                        C√≥digo Postal *
                                    </label>
                                    <input type="text" id="codigoPostal" name="codigoPostal" 
                                           value="${existingData?.codigoPostal || ''}"
                                           placeholder="Ej: 91000" required maxlength="5"
                                           style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                  border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                  color: var(--text-primary); font-size: 1rem;">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                            Calle o Avenida *
                                        </label>
                                        <input type="text" id="calleAvenida" name="calleAvenida" 
                                               value="${existingData?.calleAvenida || ''}"
                                               placeholder="Ej: Av. Xalapa" required
                                               style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                      border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                      color: var(--text-primary); font-size: 1rem;">
                                    </div>
                                    <div>
                                        <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                            N√∫mero *
                                        </label>
                                        <input type="text" id="numeroCasa" name="numeroCasa" 
                                               value="${existingData?.numeroCasa || ''}"
                                               placeholder="Ej: 123" required
                                               style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                      border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                      color: var(--text-primary); font-size: 1rem;">
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: bold;">
                                        Referencia Cercana
                                    </label>
                                    <input type="text" id="referencia" name="referencia" 
                                           value="${existingData?.referencia || ''}"
                                           placeholder="Ej: Frente al parque central, casa azul"
                                           style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.1); 
                                                  border-radius: 10px; background: rgba(255,255,255,0.05); 
                                                  color: var(--text-primary); font-size: 1rem;">
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 2rem;">
                                <button type="submit" 
                                        style="background: linear-gradient(45deg, var(--primary), var(--primary-light)); 
                                               color: var(--secondary); border: none; padding: 12px 24px; 
                                               border-radius: 25px; font-weight: bold; cursor: pointer; 
                                               transition: all 0.3s ease; margin: 5px;">
                                    ${isEditing ? 'üíæ Guardar Cambios' : 'üíæ Guardar y Continuar'}
                                </button>
                                <button type="button" onclick="MobileApp.showAddressSelector(currentProduct)" 
                                        style="background: rgba(255,255,255,0.05); color: white; 
                                               border: 1px solid rgba(255,255,255,0.1); padding: 12px 24px; 
                                               border-radius: 25px; font-weight: bold; cursor: pointer; 
                                               transition: all 0.3s ease; margin: 5px;">
                                    ‚Üê Volver a Direcciones
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.body.appendChild(modal);
                document.body.style.overflow = 'hidden';
                
                // Configurar evento del formulario
                const form = modal.querySelector('#addressForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAddressFormSubmit(productId, editIndex);
                });
                
                // Mostrar con animaci√≥n
                setTimeout(() => {
                    modal.classList.add('active');
                }, 10);
                
                console.log('‚úÖ Formulario de direcci√≥n mostrado');
            }
            
            handleAddressFormSubmit(productId, editIndex = null) {
                console.log('üíæ Procesando formulario de direcci√≥n');
                
                // Recopilar datos del formulario
                const formData = {
                    nombreCompleto: document.getElementById('nombreCompleto').value.trim(),
                    telefono: document.getElementById('telefono').value.trim(),
                    estado: document.getElementById('estado').value.trim(),
                    municipio: document.getElementById('municipio').value.trim(),
                    codigoPostal: document.getElementById('codigoPostal').value.trim(),
                    calleAvenida: document.getElementById('calleAvenida').value.trim(),
                    numeroCasa: document.getElementById('numeroCasa').value.trim(),
                    referencia: document.getElementById('referencia').value.trim()
                };
                
                // Validar datos
                const errors = this.validateAddressData(formData);
                if (errors.length > 0) {
                    alert('Por favor corrige los siguientes errores:\n\n' + errors.join('\n'));
                    return;
                }
                
                // Guardar direcci√≥n
                if (this.saveAddress(formData, editIndex)) {
                    // Cerrar formulario
                    window.closeModal('.address-form-modal');
                    
                    // Si es nueva direcci√≥n, usarla inmediatamente
                    if (editIndex === null) {
                        this.processOrderWithAddress(currentProduct, formData);
                    } else {
                        // Si es edici√≥n, volver al selector
                        this.showAddressSelector(currentProduct);
                        this.showNotification('‚úÖ Direcci√≥n actualizada correctamente', 'success');
                    }
                } else {
                    alert('Error guardando la direcci√≥n. Int√©ntalo de nuevo.');
                }
            }
            
            validateAddressData(data) {
                const errors = [];
                
                if (!data.nombreCompleto) errors.push('- Nombre completo es requerido');
                if (!data.telefono) errors.push('- Tel√©fono es requerido');
                else if (!/^\d{10}$/.test(data.telefono)) errors.push('- Tel√©fono debe tener 10 d√≠gitos');
                if (!data.estado) errors.push('- Estado es requerido');
                if (!data.municipio) errors.push('- Municipio es requerido');
                if (!data.codigoPostal) errors.push('- C√≥digo postal es requerido');
                else if (!/^\d{5}$/.test(data.codigoPostal)) errors.push('- C√≥digo postal debe tener 5 d√≠gitos');
                if (!data.calleAvenida) errors.push('- Calle o avenida es requerida');
                if (!data.numeroCasa) errors.push('- N√∫mero de casa es requerido');
                
                return errors;
            }
            
            selectAddress(index) {
                console.log('üìç Direcci√≥n seleccionada:', index);
                // Resaltar la direcci√≥n seleccionada
                document.querySelectorAll('.address-card').forEach((card, i) => {
                    if (i === index) {
                        card.style.borderColor = 'var(--primary)';
                        card.style.background = 'rgba(255, 215, 0, 0.1)';
                    } else {
                        card.style.borderColor = 'rgba(255,255,255,0.1)';
                        card.style.background = 'rgba(255,255,255,0.05)';
                    }
                });
            }
            
            useThisAddress(index) {
                const addresses = this.getSavedAddresses();
                if (index >= 0 && index < addresses.length) {
                    const selectedAddress = addresses[index];
                    console.log('‚úÖ Usando direcci√≥n:', selectedAddress);
                    
                    // Cerrar modal de selecci√≥n
                    window.closeModal('.address-selector-modal');
                    
                    // Procesar pedido con la direcci√≥n seleccionada
                    this.processOrderWithAddress(currentProduct, selectedAddress);
                }
            }
            
            addNewAddress(productId) {
                console.log('‚ûï Agregando nueva direcci√≥n');
                
                // Cerrar modal de selecci√≥n
                window.closeModal('.address-selector-modal');
                
                // Mostrar formulario de nueva direcci√≥n
                this.showAddressForm(productId);
            }
            
            editAddress(index) {
                console.log('‚úèÔ∏è Editando direcci√≥n:', index);
                const addresses = this.getSavedAddresses();
                if (index >= 0 && index < addresses.length) {
                    // Cerrar modal de selecci√≥n
                    window.closeModal('.address-selector-modal');
                    
                    // Mostrar formulario con datos pre-llenados
                    this.showAddressForm(currentProduct.id, addresses[index], index);
                }
            }
            
            deleteAddressConfirm(index) {
                const addresses = this.getSavedAddresses();
                if (index >= 0 && index < addresses.length) {
                    const address = addresses[index];
                    
                    if (confirm(`¬øEst√°s seguro de que quieres eliminar la direcci√≥n de ${address.nombreCompleto}?`)) {
                        if (this.deleteAddress(index)) {
                            // Actualizar la lista
                            const addressesList = document.getElementById('addressesList');
                            if (addressesList) {
                                addressesList.innerHTML = this.renderAddressesList(this.getSavedAddresses());
                            }
                            
                            // Mostrar notificaci√≥n
                            this.showNotification('üóëÔ∏è Direcci√≥n eliminada correctamente', 'success');
                        }
                    }
                }
            }
            
            saveAddress(addressData, index = null) {
                try {
                    let addresses = this.getSavedAddresses();
                    
                    if (index !== null && index < addresses.length) {
                        // Actualizar direcci√≥n existente
                        addresses[index] = { ...addressData, id: addresses[index].id };
                    } else {
                        // Agregar nueva direcci√≥n
                        addressData.id = Date.now();
                        addresses.push(addressData);
                    }
                    
                    localStorage.setItem('aa_customer_addresses', JSON.stringify(addresses));
                    console.log('üíæ Direcci√≥n guardada:', addressData);
                    return true;
                } catch (error) {
                    console.error('Error guardando direcci√≥n:', error);
                    return false;
                }
            }
            
            deleteAddress(index) {
                try {
                    let addresses = this.getSavedAddresses();
                    if (index >= 0 && index < addresses.length) {
                        addresses.splice(index, 1);
                        localStorage.setItem('aa_customer_addresses', JSON.stringify(addresses));
                        console.log('üóëÔ∏è Direcci√≥n eliminada');
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('Error eliminando direcci√≥n:', error);
                    return false;
                }
            }
            
            processOrderWithAddress(product, addressData) {
                console.log('üì¶ Procesando pedido con direcci√≥n seleccionada');
                
                let mensaje = `üõí *Pedido de ${product.nombre}*\n\n`;
                mensaje += `üì¶ Producto: ${product.nombre}\n`;
                mensaje += `‚ú® Inspirado en: ${product.inspirado || 'Fragancia exclusiva'}\n`;
                mensaje += `üìù Descripci√≥n: ${product.descripcion}\n\n`;
                
                // Usar precio por defecto si CONFIG no est√° disponible
                const precio = (CONFIG && CONFIG.precios && CONFIG.precios.tama√±os && CONFIG.precios.tama√±os[selectedSize]) || 'Desde $90';
                mensaje += `üí∞ Precio: ${precio}\n\n`;
                
                // Agregar datos de entrega
                mensaje += `üìç *Datos de Entrega:*\n`;
                mensaje += `üë§ Nombre: ${addressData.nombreCompleto}\n`;
                mensaje += `üì± Tel√©fono: ${addressData.telefono}\n\n`;
                mensaje += `üè† Direcci√≥n:\n`;
                mensaje += `${addressData.calleAvenida} #${addressData.numeroCasa}\n`;
                mensaje += `${addressData.municipio}, ${addressData.estado}\n`;
                mensaje += `CP: ${addressData.codigoPostal}\n`;
                if (addressData.referencia) {
                    mensaje += `üìç Referencia: ${addressData.referencia}\n`;
                }
                
                mensaje += `\n\nüìù Por favor confirma disponibilidad, tama√±os disponibles y m√©todo de pago.`;
                
                const whatsappNumber = (CONFIG && CONFIG.whatsapp && CONFIG.whatsapp.numero) || '2721224946';
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(mensaje)}`;
                window.open(whatsappUrl, '_blank');
                
                this.showNotification('‚úÖ Pedido enviado a WhatsApp con direcci√≥n seleccionada', 'success');
                console.log('‚úÖ Mensaje enviado a WhatsApp con direcci√≥n');
            }
            
            showNotification(mensaje, type = 'info') {
                const notification = document.createElement('div');
                const colors = {
                    'success': 'linear-gradient(45deg, #00ff88, #00cc6a)',
                    'error': 'linear-gradient(45deg, #ff4757, #ff6b7a)',
                    'warning': 'linear-gradient(45deg, #ffa500, #ff8c00)',
                    'info': 'linear-gradient(45deg, #3742fa, #5352ed)'
                };
                
                notification.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: ${colors[type] || colors.info};
                    color: ${type === 'warning' ? '#000' : 'white'};
                    padding: 1rem 1.5rem;
                    border-radius: 15px;
                    font-weight: bold;
                    z-index: 10001;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    max-width: 300px;
                `;
                
                notification.textContent = mensaje;
                document.body.appendChild(notification);
                
                // Animaci√≥n de entrada
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Remover despu√©s de 4 segundos
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }
        }
        
        // Funci√≥n para verificar dependencias
        function checkDependencies() {
            const missing = [];
            
            if (typeof CONFIG === 'undefined') {
                missing.push('CONFIG (config.js)');
            }
            
            if (typeof PRODUCTOS === 'undefined') {
                missing.push('PRODUCTOS (config.js)');
            }
            
            if (typeof customerDataManager === 'undefined') {
                missing.push('customerDataManager (customer-data.js)');
            }
            
            return missing;
        }
        
        // Inicializaci√≥n con verificaci√≥n de dependencias
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM cargado, verificando dependencias...');
            
            // Esperar un poco para que se carguen los scripts
            setTimeout(() => {
                const missingDeps = checkDependencies();
                
                if (missingDeps.length > 0) {
                    console.error('‚ùå Dependencias faltantes:', missingDeps);
                    document.body.style.borderColor = 'orange';
                    
                    // Mostrar advertencia pero intentar continuar
                    const warning = document.createElement('div');
                    warning.style.cssText = `
                        position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
                        background: rgba(255, 165, 0, 0.9); color: white; padding: 10px 20px;
                        border-radius: 10px; z-index: 10000; font-size: 0.9rem;
                    `;
                    warning.innerHTML = `‚ö†Ô∏è Algunas funciones pueden no estar disponibles: ${missingDeps.join(', ')}`;
                    document.body.appendChild(warning);
                    
                    setTimeout(() => warning.remove(), 5000);
                }
                
                try {
                    // Inicializar MobileApp
                    window.MobileApp = new MobileAAApp();
                    console.log('üåç MobileApp disponible globalmente');
                    
                    // Integrar sistema de b√∫squeda m√≥vil
                    setTimeout(() => {
                        integrarBusquedaMovil();
                        
                        // Agregar evento adicional para manejar cuando se borra el input
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                            searchInput.addEventListener('input', function(e) {
                                const query = e.target.value.trim();
                                if (query.length === 0) {
                                    // Si el input est√° vac√≠o, mostrar novedades
                                    console.log('üßπ Input de b√∫squeda vac√≠o, mostrando novedades');
                                    limpiarBusquedaMovil();
                                }
                            });
                            
                            console.log('‚úÖ Evento de input agregado para manejar b√∫squeda vac√≠a');
                        }
                    }, 1000);
                    
                } catch (error) {
                    console.error('‚ùå Error cr√≠tico:', error);
                    document.body.style.borderColor = 'red';
                    
                    // Mostrar error en pantalla
                    document.body.innerHTML = `
                        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                                    background: rgba(255,0,0,0.9); color: white; padding: 20px; 
                                    border-radius: 10px; text-align: center; z-index: 10000; max-width: 90%;">
                            <h3>‚ùå Error de Inicializaci√≥n</h3>
                            <p style="margin: 10px 0;">${error.message}</p>
                            <p style="font-size: 0.8rem; opacity: 0.8; margin-bottom: 15px;">
                                Verifica que todos los archivos JS est√©n cargados correctamente
                            </p>
                            <button onclick="location.reload()" style="margin-top: 10px; padding: 10px 20px; 
                                    background: white; color: red; border: none; border-radius: 5px; cursor: pointer;">
                                üîÑ Recargar P√°gina
                            </button>
                        </div>
                    `;
                }
            }, 500); // Esperar 500ms para que se carguen los scripts
        });
        
        // Funciones globales para uso en modales y b√∫squeda
        window.requestProductOrder = function(product) {
            if (window.MobileApp && typeof window.MobileApp.requestProductOrder === 'function') {
                window.MobileApp.requestProductOrder(product);
            } else {
                console.error('‚ùå MobileApp no est√° disponible');
            }
        };
        
        window.limpiarBusquedaMovil = limpiarBusquedaMovil;
        window.mostrarProductoEnCatalogoMovil = mostrarProductoEnCatalogoMovil;
        
        window.closeModal = function(modalSelector = '.product-modal') {
            const modal = document.querySelector(modalSelector);
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => {
                    modal.remove();
                    document.body.style.overflow = 'auto';
                }, 300);
            }
        };
        
        window.clearCustomerData = function() {
            if (typeof customerDataManager !== 'undefined') {
                customerDataManager.clearData();
                console.log('üóëÔ∏è Datos del cliente eliminados');
                
                // Mostrar notificaci√≥n
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: linear-gradient(45deg, #ff6b35, #f7931e);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 15px;
                    font-weight: bold;
                    z-index: 10001;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                    box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
                    max-width: 300px;
                `;
                notification.textContent = 'üóëÔ∏è Datos de direcci√≥n eliminados. Se pedir√°n nuevamente en el pr√≥ximo pedido.';
                document.body.appendChild(notification);
                
                // Animaci√≥n de entrada
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Remover despu√©s de 4 segundos
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
                
            } else {
                console.warn('‚ö†Ô∏è customerDataManager no est√° disponible');
            }
        };
        
        // Manejo de errores globales
        window.addEventListener('error', (e) => {
            console.error('‚ùå Error global:', e.error);
            document.body.style.borderColor = 'red';
        });
        
        console.log('üì± A&A Mobile Ultra con JS reutilizados cargado correctamente');
        
        // ===== INICIALIZACI√ìN DE M√öSICA DE FONDO M√ìVIL SIMPLE =====
        
        setTimeout(() => {
            console.log('üéµ Sistema de m√∫sica simple inicializado para A&A Mobile');
            // El sistema simple se inicializa autom√°ticamente
            // La m√∫sica comenzar√° tras la primera interacci√≥n del usuario
            // Incluye pausa/reanudaci√≥n autom√°tica al cambiar de pesta√±a
        }, 500);

        // ===== INTEGRACI√ìN DE B√öSQUEDA M√ìVIL =====
        
        function integrarBusquedaMovil() {
            if (window.searchAA) {
                console.log('‚úÖ Integrando b√∫squeda m√≥vil con A&A');
                
                // Sobrescribir clearResults para mostrar novedades cuando se limpia la b√∫squeda
                const originalClearResults = window.searchAA.clearResults;
                window.searchAA.clearResults = function() {
                    // Limpiar resultados de b√∫squeda
                    const resultsContainer = document.getElementById('search-results');
                    if (resultsContainer) {
                        resultsContainer.innerHTML = '';
                        resultsContainer.style.display = 'none';
                    }
                    
                    // Mostrar el contenedor principal
                    const container = document.querySelector('.container');
                    if (container) {
                        container.style.display = 'block';
                    }
                    
                    // Mostrar novedades cuando se limpia la b√∫squeda
                    if (window.MobileApp && typeof window.MobileApp.showNovedades === 'function') {
                        window.MobileApp.showNovedades();
                    }
                };
                
                // Sobrescribir performSearch para manejar b√∫squedas vac√≠as
                const originalPerformSearch = window.searchAA.performSearch;
                window.searchAA.performSearch = function(query) {
                    if (!query || query.trim().length === 0) {
                        // Si la b√∫squeda est√° vac√≠a, mostrar novedades
                        this.clearResults();
                        return;
                    }
                    
                    // Si hay query, proceder con b√∫squeda normal
                    originalPerformSearch.call(this, query);
                };
                
                // Sobrescribir displayResults para estilo m√≥vil
                window.searchAA.displayResults = function(results, query) {
                    const searchResults = document.getElementById('search-results');
                    const container = document.querySelector('.container');
                    const novedadesContainer = document.getElementById('novedadesContainer');
                    const productsGrid = document.getElementById('productsGrid');
                    
                    // Ocultar novedades y productos cuando se muestran resultados de b√∫squeda
                    if (novedadesContainer) novedadesContainer.style.display = 'none';
                    if (productsGrid) productsGrid.style.display = 'none';
                    if (container) container.style.display = 'none';
                    
                    if (results.length === 0) {
                        // Mostrar mensaje de no resultados
                        searchResults.innerHTML = `
                            <div class="no-results-mobile">
                                <div class="no-results-icon">üîç</div>
                                <h3>No se encontraron perfumes</h3>
                                <p>No hay perfumes que coincidan con "${query}"</p>
                                <button onclick="limpiarBusquedaMovil()" class="btn-show-all-mobile">
                                    Ver novedades
                                </button>
                            </div>
                        `;
                        searchResults.className = 'search-results-mobile';
                        searchResults.style.display = 'block';
                        return;
                    }
                    
                    // Mostrar resultados
                    let html = `
                        <div class="search-header-mobile">
                            <h3>Resultados de b√∫squeda</h3>
                            <p>Se encontraron ${results.length} perfume${results.length !== 1 ? 's' : ''} para "${query}"</p>
                            <button onclick="limpiarBusquedaMovil()" class="btn-show-all-small-mobile">
                                Ver todos
                            </button>
                        </div>
                        <div class="products-grid-search-mobile">
                    `;
                    
                    results.forEach(producto => {
                        html += `
                            <div class="product-card-search-mobile" onclick="mostrarProductoEnCatalogoMovil(${producto.id})">
                                <div class="product-image-search-mobile">
                                    <img src="${producto.imagen}" alt="${producto.nombre}" onerror="this.src='recursos/A&A/placeholder-perfume.jpg'">
                                    <div class="product-category-search-mobile">
                                        ${producto.categoria === 'hombre' ? 'üë® Caballero' : 'üë© Dama'}
                                    </div>
                                </div>
                                <div class="product-info-search-mobile">
                                    <h4 class="product-name-search-mobile">${producto.nombre}</h4>
                                    <p class="product-inspired-search-mobile">${producto.inspirado}</p>
                                    <p class="product-description-search-mobile">${producto.descripcion}</p>
                                    <div class="product-price-search-mobile">${producto.precio}</div>
                                    <div class="product-actions-mobile" style="margin-top: 8px; display: flex; gap: 8px;">
                                        <button onclick="event.stopPropagation(); openProductModal('${producto.nombre}')" 
                                                style="flex: 1; background: #ffd700; color: #2c2c2c; border: none; padding: 8px; border-radius: 8px; font-size: 12px; font-weight: 600;">
                                            Seleccionar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    searchResults.innerHTML = html;
                    searchResults.className = 'search-results-mobile';
                    searchResults.style.display = 'block';
                };
                
                // Sobrescribir selectProduct para usar el modal existente
                const originalSelectProduct = window.searchAA.selectProduct;
                window.searchAA.selectProduct = function(productId) {
                    const producto = PRODUCTOS.find(p => p.id === productId);
                    if (producto && typeof mostrarModalTama√±os === 'function') {
                        mostrarModalTama√±os(producto);
                    } else if (originalSelectProduct) {
                        originalSelectProduct.call(this, productId);
                    }
                };
                
            } else {
                setTimeout(integrarBusquedaMovil, 500);
            }
        }
        
        // Funci√≥n para limpiar b√∫squeda m√≥vil
        function limpiarBusquedaMovil() {
            console.log('üßπ Limpiando b√∫squeda m√≥vil');
            
            // Limpiar input de b√∫squeda
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            
            // Ocultar resultados de b√∫squeda
            const searchResults = document.getElementById('search-results');
            if (searchResults) {
                searchResults.innerHTML = '';
                searchResults.style.display = 'none';
            }
            
            // Mostrar el contenedor principal
            const container = document.querySelector('.container');
            if (container) container.style.display = 'block';
            
            // Ocultar grid de productos
            const productsGrid = document.getElementById('productsGrid');
            if (productsGrid) productsGrid.style.display = 'none';
            
            // Mostrar novedades (estado inicial)
            if (window.MobileApp && typeof window.MobileApp.showNovedades === 'function') {
                window.MobileApp.showNovedades();
            }
            
            // Resetear filtros activos
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            console.log('‚úÖ B√∫squeda limpiada, mostrando estado inicial');
        }
        
        // Funci√≥n para mostrar producto en cat√°logo m√≥vil
        function mostrarProductoEnCatalogoMovil(productId) {
            const producto = PRODUCTOS.find(p => p.id === productId);
            if (!producto) return;
            
            console.log('üìç Mostrando producto en cat√°logo m√≥vil:', producto.nombre);
            
            // Limpiar b√∫squeda
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            
            // Ocultar resultados de b√∫squeda
            const searchResults = document.getElementById('search-results');
            if (searchResults) searchResults.style.display = 'none';
            
            // Mostrar el cat√°logo principal con el producto espec√≠fico
            const container = document.querySelector('.container');
            if (container) container.style.display = 'block';
            
            // Cargar productos de la categor√≠a del producto seleccionado
            if (window.MobileApp) {
                const categoria = producto.categoria === 'hombre' ? 'caballero' : 
                                 producto.categoria === 'mujer' ? 'dama' : 
                                 producto.categoria;
                window.MobileApp.loadProducts(categoria);
                
                // Scroll al producto despu√©s de un momento
                setTimeout(() => {
                    const productCards = document.querySelectorAll('.product-card');
                    productCards.forEach(card => {
                        const productName = card.querySelector('.product-name');
                        if (productName && productName.textContent.includes(producto.nombre)) {
                            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            card.style.border = '3px solid #ffd700';
                            card.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.5)';
                            card.style.animation = 'pulse 2s ease-in-out';
                        }
                    });
                }, 500);
            }
            
            // Filtrar para mostrar solo este producto
            const productsGrid = document.getElementById('productsGrid');
            if (productsGrid) {
                productsGrid.innerHTML = `
                    <div class="product-card featured-product" style="border: 3px solid #ffd700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); animation: pulse 2s ease-in-out;">
                        <div class="product-image">
                            <img src="${producto.imagen}" alt="${producto.nombre}" onerror="this.src='recursos/A&A/placeholder-perfume.jpg'">
                            <div class="product-category">${producto.categoria === 'hombre' ? 'üë® Caballero' : 'üë© Dama'}</div>
                        </div>
                        <div class="product-info">
                            <h4 class="product-name">${producto.nombre}</h4>
                            <p class="product-inspired">${producto.inspirado}</p>
                            <p class="product-description">${producto.descripcion}</p>
                            <div class="product-price">${producto.precio}</div>
                            <button class="btn-contact" onclick="openProductModal('${producto.nombre}')">
                                Seleccionar perfume
                            </button>
                        </div>
                    </div>
                `;
                
                // Scroll al producto
                productsGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Funci√≥n para limpiar b√∫squeda m√≥vil
        function limpiarBusquedaMovil() {
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            const container = document.querySelector('.container');
            
            // Limpiar input
            if (searchInput) searchInput.value = '';
            
            // Ocultar resultados de b√∫squeda
            if (searchResults) searchResults.style.display = 'none';
            
            // Mostrar vista normal
            if (container) container.style.display = 'block';
            
            // Recargar productos si es necesario
            if (typeof loadProducts === 'function') {
                loadProducts();
            }
        }
        
        // Hacer funci√≥n disponible globalmente
        window.limpiarBusquedaMovil = limpiarBusquedaMovil;
        
        // Inicializar integraci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(integrarBusquedaMovil, 1000);
        });

    </script>
</body>
</html>